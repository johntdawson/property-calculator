<!DOCTYPE html>
<html>

<head>
  <title>Property Calculator</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="css/themes/default/jquery.mobile-1.4.3.min.css">
	<link rel="shortcut icon" href="favicon.ico">
  <style>
    #footer { text-align: center; }
    .ui-controlgroup-controls { padding: 0 9px; }
    .ui-header .ui-title { margin: 0 10%; }
    .ui-footer .ui-title { margin: 0; }
    .collapsible { padding:0 8px; }
    .value { position:absolute; right:40px;top:13px; }
    .money:before { content:"$" }
    .percent:after { content:"%" }
    .ui-icon-calculator:after { background-image: url("img/calculator-white.svg"); }
    .ui-icon-logo:after { background-image: url("img/logo-white.svg"); }
    .ui-header-fixed, .ui-footer-fixed { background-color: #2ad; border-color: #2ad; color: #fff; text-shadow: 0 1px 0 #08b; }
    #summary h2 a { background-color: #29e3b4; border-color: #29e3b4; color: #fff; text-shadow: 0 1px 0 #08b; }
    .ui-li-divider { background-color: #ccc; border-color: #eaeaea; color: #666; text-shadow: none; font-weight: normal; }
  </style>
	<script src="js/jquery.js"></script>
	<script src="js/jquery.mobile-1.4.3.min.js"></script>
	<script src="js/jquery.mask.js"></script>
  <script>
    $(document).on( "pagecreate", function() {

      // Remember scroll position
      $( document ).delegate("#main", "pagebeforeshow", function() {
        $('li').on('click', function(){
          scrollPosition = $(document).scrollTop();
        });
      });
      $( document ).delegate("#main", "pageshow", function() {
          if(scrollPosition !== null) {
            $.mobile.silentScroll(scrollPosition);
          }
      });
      var scrollPosition = null;

      // Calculate
      calculate();

      // Create page for each list item
      $('body').on( "click", '.page li a', function(e) {
        $('.ui-dialog-temp').remove(); //garbage collection
        href = $(this).attr('href').replace("#" , "");
        createPage(page[href]);
      });

      createPage = function(page) {

        // Create pages with input fields
        if (page.type=='input') {
          $('body').append(
            '<div data-role="page" id="' + page.id + '" class="ui-dialog-temp" data-theme="a">' +
            '	<div data-role="header" data-theme="a" data-position="fixed" data-tap-toggle="false">' +
            '   <a class="ui-btn ui-btn-icon-left ui-icon-carat-l ui-btn-icon-notext ui-corner-all" href="#'+page.back+'" data-transition="slidefade" data-direction="reverse">Back</a>' +
            '		<h1>' + page.title + '</h1>' +
            '   <a id="save" class="ui-btn ui-btn-right ui-icon-check ui-btn-icon-notext ui-corner-all" href="#'+page.back+'" data-transition="slidefade" data-direction="reverse">Save</a>' +
            '	</div>' +
            '	<div role="main" class="ui-content">' +
            '   <input class="inputvalue '+page.mask+'" name="number" pattern="[0-9]*" id="number-pattern" value="'+page.value+'" type="text" data-clear-btn="true">' +
            page.content +
            '	</div>' +
            '</div>'
          );

          // Input mask (http://igorescobar.github.io/jQuery-Mask-Plugin)
          $('.currency').mask('000,000,000', {reverse: true});
          $('.percent').mask('0Z.0ZZ', {translation:  {'Z': {pattern: /[0-9]/, optional: true}}});
          $('.years').mask('00', {reverse: true});
          
          // Bind enter key to specific button on page if input focused
          $(document).keypress(function(e){
            if (e.which == 13 && $(".inputvalue").is(":focus") ){
              $("#save").click();
            }
          });

        }

        // Create pages with info dialogs
        if (page.type=='info') {
          $('body').append(
            '<div data-role="page" id="' + page.id + '" class="ui-dialog-temp" data-theme="a">' +
            '	<div data-role="header" data-theme="a" data-position="fixed" data-tap-toggle="false">' +
            '		<h1>' + page.title + '</h1>' +
            '	</div>' +
            '	<div role="main" class="ui-content">' +
            page.content +
            '	</div>' +
            '</div>'
          );
        }

      }

      // Submit input values
      $('body').on( "click", "#save", function(e) {
        var key = $(this).parent().parent().attr('id');
        var value = $('#'+key+' .inputvalue').val();
        $("a[href='#"+key+"'] span.value").html(value);
        calculate();
      });


      // Auto-fill sample data
      //$('.ui-icon-calculator').click(function() {
        $("a[href='#estimatedPropertyValue'] span.value").html('100000');
        $("a[href='#purchasePrice'] span.value").html('50000');
        $("a[href='#downPaymentPercent'] span.value").html('20');
        $("a[href='#mortgageInterestRate'] span.value").html('5.0');
        $("a[href='#mortgageLoanTerm'] span.value").html('30');
        $("a[href='#closingCostsPercent'] span.value").html('5.0');
        $("a[href='#rentalIncome'] span.value").html('900');
        $("a[href='#propertyTaxes'] span.value").html('193');
        $("a[href='#propertyInsurance'] span.value").html('50');
        $("a[href='#homeownersAssociation'] span.value").html('0');
        $("a[href='#propertyManagementPercent'] span.value").html('8.0');
        $("a[href='#maintenanceReservePercent'] span.value").html('0');
        $("a[href='#vacancyAllowancePercent'] span.value").html('0');
        $("a[href='#appreciationRate'] span.value").html('3');
        $("a[href='#rentalIncrease'] span.value").html('0');
        $("a[href='#propertyTaxIncrease'] span.value").html('0');
        calculate();
      //});


      // Calculate Values
      function calculate() {
        estimatedPropertyValue = clean( $("a[href='#estimatedPropertyValue'] span.value").html() );
        purchasePrice = clean( $("a[href='#purchasePrice'] span.value").html() );
        downPaymentPercent = clean( $("a[href='#downPaymentPercent'] span.value").html() );
        closingCostsPercent = clean( $("a[href='#closingCostsPercent'] span.value").html() );
        downPayment = purchasePrice * downPaymentPercent / 100;
        equityAtPurchase = estimatedPropertyValue - purchasePrice + downPayment;
        loanAmount = purchasePrice - downPayment;
        closingCosts = loanAmount * closingCostsPercent / 100;
        cashAtClosing = downPayment + closingCosts;
        mortgageInterestRate = clean( $("a[href='#mortgageInterestRate'] span.value").html() );
        mortgageLoanTerm = clean( $("a[href='#mortgageLoanTerm'] span.value").html() );
        mortgagePayment = Math.round ( -1 * PMT( ( mortgageInterestRate / 100 / 12 ), mortgageLoanTerm * 12, loanAmount) );
        mortgagePaymentYearly = mortgagePayment * 12;
        rentalIncome = clean( $("a[href='#rentalIncome'] span.value").html() );
        propertyTaxes = clean( $("a[href='#propertyTaxes'] span.value").html() );
        propertyInsurance = clean( $("a[href='#propertyInsurance'] span.value").html() );
        homeownersAssociation = clean( $("a[href='#homeownersAssociation'] span.value").html() );
        propertyManagementPercent = clean( $("a[href='#propertyManagementPercent'] span.value").html() );
        maintenanceReservePercent = clean( $("a[href='#maintenanceReservePercent'] span.value").html() );        
        vacancyAllowancePercent = clean( $("a[href='#vacancyAllowancePercent'] span.value").html() );
        propertyManagement = Math.round( propertyManagementPercent / 100 * rentalIncome );
        maintenanceReserve = Math.round( maintenanceReservePercent / 100 * rentalIncome );
        vacancyAllowance = Math.round( vacancyAllowancePercent / 100 * rentalIncome );
        operatingExpenses = propertyTaxes + propertyInsurance + homeownersAssociation + propertyManagement + maintenanceReserve + vacancyAllowance;
        monthlyCashFlow = rentalIncome - operatingExpenses - mortgagePayment;
        appreciationRate = clean( $("a[href='#appreciationRate'] span.value").html() );        
        appreciationYear1 = Math.round( estimatedPropertyValue * appreciationRate / 100 );
        principleYear1 = Math.round( BalancePaid( mortgagePayment, ( mortgageInterestRate / 100 ), loanAmount, 12 ) );
        cashOnCashReturn = ( ( ( monthlyCashFlow * 12 ) + appreciationYear1 + principleYear1 ) / cashAtClosing ) * 100;
        capRate = ( ( ( rentalIncome - operatingExpenses ) * 12 ) / purchasePrice ) * 100;
        propertyValueYear5 = Compound( estimatedPropertyValue, ( appreciationRate / 100 ), 4 );
        equityInFiveYears = Math.round( propertyValueYear5 - ( loanAmount - BalancePaid( mortgagePayment, ( mortgageInterestRate / 100 ), loanAmount, 60 ) ) );
        // Update view
        getPageData();
        update();
      }

      // Update Values
      function update() {
        $("a[href='#downPayment'] span.value").html(downPayment.toFixed(0));
        $("a[href='#equityAtPurchase'] span.value").html(equityAtPurchase.toFixed(0));
        $("a[href='#loanAmount'] span.value").html(loanAmount.toFixed(0));
        $("a[href='#closingCosts'] span.value").html(closingCosts.toFixed(0));
        $("a[href='#cashAtClosing'] span.value").html(cashAtClosing.toFixed(0));
        $("a[href='#mortgagePayment'] span.value").html(mortgagePayment.toFixed(0));
        $("a[href='#mortgagePaymentYearly'] span.value").html(mortgagePaymentYearly.toFixed(0));
        $("a[href='#propertyManagement'] span.value").html(propertyManagement.toFixed(0));
        $("a[href='#maintenanceReserve'] span.value").html(maintenanceReserve.toFixed(0));
        $("a[href='#vacancyAllowance'] span.value").html(vacancyAllowance.toFixed(0));
        $("a[href='#monthlyCashFlow'] span.value").html(monthlyCashFlow.toFixed(0));
        $("a[href='#cashOnCashReturn'] span.value").html(cashOnCashReturn.toFixed(2));
        $("a[href='#capRate'] span.value").html(capRate.toFixed(2));
        $("a[href='#equityInFiveYears'] span.value").html(equityInFiveYears.toFixed(0));
      }

      // Clean number
      function clean( str ) {
        str = str.replace("," , "");
        str = str.replace("%" , "");
        str = Number(str);
        return str;
      }
      
      // Mortgage PMT formula
      function PMT(i, n, p) {
        return i * p * Math.pow((1 + i), n) / (1 - Math.pow((1 + i), n));
      }

      // Balance Paid formula
      function BalancePaid( MonthlyPayment, Rate, Principle, months ) {
          return ((12 * MonthlyPayment) / Rate - Principle) * (Math.pow((1 + Rate / 12), months) - 1)
      }

      // Compounded Interest formula 
      function Compound(Orig, rate, yrs) {   
        return Orig * Math.pow((1.00 + rate), yrs);
      }

      // Page data
      function getPageData() {
        page = {
          estimatedPropertyValue : {
            id : "estimatedPropertyValue",
            title : "Estimated Property Value",
            type : "input",
            mask : "currency",
            back : "main",
            value: estimatedPropertyValue,
            content : "<p>The estimated property value can be determined from comparable property sales, Multiple Listing Service (MLS) data, appraisal reports, public records, etc. This figure is used as a baseline amount to estimate equity yet is not used to estimate cash flow.</p>"
          },
          purchasePrice : {
            id : "purchasePrice",
            title : "Purchase Price",
            type : "input",
            mask : "currency",
            back : "main",
            value: purchasePrice,
            content : "<p>The purchase price is the listed price, seller's price, or the anticipated cost of purchasing the property.</p>"
          },
          downPayment : {
            id : "downPayment",
            title : "Down Payment",
            type : "info",
            back : "main",
            content : "<p>The down payment is a type of payment made in cash during the onset of the purchase of a property. The payment typically represents only a percentage of the full purchase price; in some cases it is not refundable if the deal falls through. Financing arrangements are made by the purchaser to cover the remaining amount owed to the seller.</p><p>Down Payment = Purchase Price x Down Payment Percent ("+downPaymentPercent+"%)</p>"
          },
          equityAtPurchase : {
            id : "equityAtPurchase",
            title : "Equity at Purchase",
            type : "info",
            back : "main",
            content : "<p>Real estate equity is the difference between the current market value of the property and the amount the owner still owes on the mortgage. It is the amount that the owner would receive after selling a property and paying off the mortgage.</p><p><em>Equity At Purchase = Estimated Property Value - Purchase Price + Down Payment</em></p>"
          },
          loanAmount : {
            id : "loanAmount",
            title : "Loan Amount",
            type : "info",
            back : "main",
            content : "<p>The loan amount is the actual amount of money the lender is willing to allow you to borrow. Typically, lenders derive the loan amount based on their Loan to Value (LTV) ratio - which is the percentage of the property's value that is mortgaged. If you divide the mortgage amount by the lesser of either the appraised value or the selling price, you get the LTV.</p>"
          },
          closingCosts : {
            id : "closingCosts",
            title : "Closing Costs",
            type : "info",
            back : "main",
            content : "<p>Closing costs are the expenses, over and above the price of the property that buyers and sellers normally incur to complete a real estate transaction. Costs incurred include loan origination fees, discount points, appraisal fees, title searches, title insurance, surveys, taxes, deed-recording fees and credit report charges.</p>"
          },
          cashAtClosing : {
            id : "cashAtClosing",
            title : "Cash At Closing",
            type : "info",
            back : "main",
            content : "<p></p>"
          },
          mortgagePayment : {
            id : "mortgagePayment",
            title : "Mortgage Payment",
            type : "info",
            back : "main",
            content : "<p></p>"
          },
          mortgagePaymentYearly : {
            id : "mortgagePaymentYearly",
            title : "Mortgage Payment Yearly",
            type : "info",
            back : "main",
            content : "<p></p>"
          },
          rentalIncome : {
            id : "rentalIncome",
            title : "Rental Income",
            type : "input",
            mask : "currency",
            back : "main",
            value: rentalIncome,
            content : "<p></p>"
          },
          propertyTaxes : {
            id : "propertyTaxes",
            title : "Property Taxes",
            type : "input",
            mask : "currency",
            back : "main",
            value : propertyTaxes,
            content : "<p></p>"
          },
          propertyInsurance : {
            id : "propertyInsurance",
            title : "Property Insurance",
            type : "input",
            mask : "currency",
            back : "main",
            value : propertyInsurance,
            content : "<p></p>"
          },
          homeownersAssociation : {
            id : "homeownersAssociation",
            title : "Homeowners Association",
            type : "input",
            mask : "currency",
            back : "main",
            value : homeownersAssociation,
            content : "<p></p>"
          },
          propertyManagement : {
            id : "propertyManagement",
            title : "Property Management",
            type : "info",
            back : "main",
            content : "<p></p>"
          },
          maintenanceReserve : {
            id : "maintenanceReserve",
            title : "Maintenance Reserve",
            type : "info",
            back : "main",
            content : "<p></p>"
          },
          vacancyAllowance : {
            id : "vacancyAllowance",
            title : "Vacancy Allowance",
            type : "info",
            back : "main",
            content : "<p></p>"
          },
          downPaymentPercent : {
            id : "downPaymentPercent",
            title : "Down Payment Percent",
            type : "input",
            mask : "percent",
            back : "settings",
            value : downPaymentPercent,
            content : "<p></p>"
          },
          mortgageInterestRate : {
            id : "mortgageInterestRate",
            title : "Mortgage Interest Rate",
            type : "input",
            mask : "percent",
            back : "settings",
            value : mortgageInterestRate,
            content : "<p></p>"
          },
          mortgageLoanTerm : {
            id : "mortgageLoanTerm",
            title : "Mortgage Loan Term",
            type : "input",
            mask : "years",
            back : "settings",
            value : mortgageLoanTerm,
            content : "<p></p>"
          },
          closingCostsPercent : {
            id : "closingCostsPercent",
            title : "Closing Costs Percent",
            type : "input",
            mask : "percent",
            back : "settings",
            value : closingCostsPercent,
            content : "<p></p>"
          },
          propertyManagementPercent : {
            id : "propertyManagementPercent",
            title : "Property Management Percent",
            type : "input",
            mask : "percent",
            back : "settings",
            value : propertyManagementPercent,
            content : "<p></p>"
          },
          maintenanceReservePercent : {
            id : "maintenanceReservePercent",
            title : "Maintenance Reserve Percent",
            type : "input",
            mask : "percent",
            back : "settings",
            value : maintenanceReservePercent,
            content : "<p></p>"
          },
          vacancyAllowancePercent : {
            id : "vacancyAllowancePercent",
            title : "Vacancy Allowance Percent",
            type : "input",
            mask : "percent",
            back : "settings",
            value : vacancyAllowancePercent,
            content : "<p></p>"
          },
          appreciationRate : {
            id : "appreciationRate",
            title : "Appreciation Rate",
            type : "input",
            mask : "percent",
            back : "settings",
            value : appreciationRate,
            content : "<p></p>"
          },
          monthlyCashFlow : {
            id : "monthlyCashFlow",
            title : "Monthly Cash Flow",
            type : "info",
            back : "main",
            content : "<p></p>"
          },
          capRate : {
            id : "capRate",
            title : "Cap Rate",
            type : "info",
            back : "main",
            content : "<p></p>"
          },
          cashOnCashReturn : {
            id : "cashOnCashReturn",
            title : "Cash On Cash Return",
            type : "info",
            back : "main",
            content : "<p></p>"
          },
          equityInFiveYears : {
            id : "equityInFiveYears",
            title : "Equity In Five Years",
            type : "info",
            back : "main",
            content : "<p></p>"
          },
        }
      }

    });
  </script>
</head>

<body>

<!---------------------------------------
MAIN
---------------------------------------->
<div data-role="page" id="main" class="page">

	<div data-role="header" data-theme="a" data-position="fixed" data-tap-toggle="false">
    <a href="#" class="ui-btn ui-corner-all ui-icon-calculator ui-btn-icon-left ui-btn-icon-notext" style="background-color: #2ad;">Calculator</a>
		<h1>Property Calculator</h1>
    <a href="#settings" class="ui-btn ui-corner-all ui-icon-gear ui-btn-icon-right ui-btn-icon-notext" data-transition="slideup">Settings</a>
	</div><!-- /header -->

	<div role="main">

    <ul data-role="listview" data-inset="false">
      <li data-role="list-divider" data-theme="b">Basic Purchase Information</li>
      <li class="ui-alt-icon ui-nodisc-icon"><a href="#estimatedPropertyValue" data-transition="slidefade">Est. Property Value<span class="value money">0</span></a></li>
      <li class="ui-alt-icon ui-nodisc-icon"><a href="#purchasePrice" data-transition="slidefade">Purchase Price<span class="value money">0</span></a></li>
      <li data-icon="info"><a href="#equityAtPurchase" data-rel="dialog">Equity at Purchase<span class="value money">0</span></a></li>
    </ul>

    <ul data-role="listview" data-inset="false">
      <li data-role="list-divider" data-theme="b">Mortgage Calculations</li>
      <li data-icon="info"><a href="#loanAmount" data-rel="dialog">Loan Amount<span class="value money">0</span></a></li>
      <li data-icon="info"><a href="#downPayment" data-rel="dialog">Down Payment<span class="value money">0</span></a></li>
      <li data-icon="info"><a href="#closingCosts" data-rel="dialog">Closing Costs<span class="value money">0</span></a></li>
      <li data-icon="info"><a href="#cashAtClosing" data-rel="dialog">Cash at Closing<span class="value money">0</span></a></li>
      <li data-icon="info"><a href="#mortgagePayment" data-rel="dialog">Mortgage Payment<span class="value money">0</span></a></li>
      <li data-icon="info"><a href="#mortgagePaymentYearly" data-rel="dialog">Mortgage Payment Yearly<span class="value money">0</span></a></li>
    </ul>
    
    <ul data-role="listview" data-inset="false">
      <li data-role="list-divider" data-theme="b" data-transition="none">Property Calculations</li>
      <li class="ui-alt-icon ui-nodisc-icon"><a href="#rentalIncome" data-transition="slidefade">Rental Income<span class="value money">0</span></a></li>
      <li class="ui-alt-icon ui-nodisc-icon"><a href="#propertyTaxes" data-transition="slidefade">Property Taxes<span class="value money">0</span></a></li>
      <li class="ui-alt-icon ui-nodisc-icon"><a href="#propertyInsurance" data-transition="slidefade">Property Insurance<span class="value money">0</span></a></li>
      <li class="ui-alt-icon ui-nodisc-icon"><a href="#homeownersAssociation" data-transition="slidefade">Homeowners Association<span class="value money">0</span></a></li>
      <li data-icon="info"><a href="#propertyManagement" data-rel="dialog">Property Management<span class="value money">0</span></a></li>
      <li data-icon="info"><a href="#maintenanceReserve" data-rel="dialog">Maintenance Reserve<span class="value money">0</span></a></li>
      <li data-icon="info"><a href="#vacancyAllowance" data-rel="dialog">Vacancy Allowance<span class="value money">0</span></a></li>
      <li data-icon="info"><a href="#mortgagePayment" data-rel="dialog">Mortgage Payment<span class="value money">0</span></a></li>
    </ul>

    <div data-role="footer" data-position="fixed" data-theme="b" data-tap-toggle="false">
      <ul data-role="listview">
        <li data-icon="info"><a href="#monthlyCashFlow" data-rel="dialog">Monthly Cash Flow<span class="value money">0</span></a></li>        
        <li data-icon="info"><a href="#capRate" data-rel="dialog">Cap Rate<span class="value percent">0</span></a></li>
        <li data-icon="info"><a href="#cashOnCashReturn" data-rel="dialog">Cash on Cash Return<span class="value percent">0</span></a></li>
        <li data-icon="info"><a href="#equityInFiveYears" data-rel="dialog">Equity in Five Years<span class="value money">0</span></a></li>
      </ul>
    </div>
    
	</div><!-- /content -->

</div><!-- /main -->


<!---------------------------------------
SETTINGS
---------------------------------------->
<div data-role="page" id="settings" class="page">

	<div data-role="header" data-theme="a" data-position="fixed" data-tap-toggle="false">
		<h1>Settings</h1>
    <a class="ui-btn ui-btn-right ui-icon-carat-d ui-btn-icon-notext ui-corner-all" href="#main" data-transition="slideup" data-direction="reverse">Back</a>
	</div><!-- /header -->

	<div role="main">
    
    <ul data-role="listview" data-inset="false" class="ui-nodisc-icon ui-alt-icon">
      <li data-role="list-divider" data-theme="b">Mortgage Assumptions</li>
      <li><a href="#downPaymentPercent" data-transition="slidefade">Down Payment Percent<span class="value percent">0</span></a></li>
      <li><a href="#mortgageInterestRate" data-transition="slidefade">Mortgage Interest Rate<span class="value percent">0</span></a></li>
      <li><a href="#mortgageLoanTerm" data-transition="slidefade">Mortgage Loan Term<span class="value term">0</span></a></li>
      <li><a href="#closingCostsPercent" data-transition="slidefade">Closing Costs Percent<span class="value percent">0</span></a></li>
      <li data-role="list-divider" data-theme="b">Property Assumptions</li>
      <li><a href="#propertyManagementPercent" data-transition="slidefade">Property Management<span class="value percent">0</span></a></li>
      <li><a href="#maintenanceReservePercent" data-transition="slidefade">Maintenance Reserve<span class="value percent">0</span></a></li>
      <li><a href="#vacancyAllowancePercent" data-transition="slidefade">Vacancy Allowance<span class="value percent">0</span></a></li>
      <li><a href="#appreciationRate" data-transition="slidefade">Appreciation Rate<span class="value percent">0</span></a></li>
    </ul>
    
	</div><!-- /content -->

</div><!-- /settings -->

</body>
</html>
